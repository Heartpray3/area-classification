ANALYSE : FEATURES ET FEATURE ENGINEERING
=========================================
(Alignement avec le sujet du cours ML : preprocessing + feature engineering)

--------------------------------------------------------------------------------
1. PREPROCESSING / FORMAT DES DONNÉES
--------------------------------------------------------------------------------

Le script preprocess_features.py charge les GeoJSON (train.geojson, test.geojson)
et produit des Parquet prêts pour le ML :
  - train_features.parquet
  - test_features.parquet

Fait dans le preprocess :
  - Nettoyage CRS (EPSG 4326 si absent), suppression des géométries vides ou NaN
  - Géométries invalides : make_valid()
  - Coords NaN/Inf : remplacement par un point sûr (ligne conservée, pas de drop)
  - Réordonnancement des dates (date0..date4 et tous les blocs img_*_date0..4)
  - Colonnes img_*_date1..5 renommées en date0..4 pour cohérence

--------------------------------------------------------------------------------
2. FEATURE ENGINEERING – CE QUI EST DEMANDÉ VS CE QUI EST FAIT
--------------------------------------------------------------------------------

2.1 Urban and Geographical types – multi-valued categorical, one-hot
--------------------------------------------------------------------
Sujet : "Urban and Geographical types are multi-valued categorical columns
         (one-hot encoding could be helpful in this case)."

Fait dans le preprocess :
  - urban_type : one-hot sur les tags (Dense Urban, Sparse Urban, Industrial,
    Rural, Urban Slum) avec _split_tags_special pour gérer les valeurs
    multiples séparées par des virgules (et le cas "N,A").
  - geography_type : one-hot sur les tags (Sparse Forest, Grass Land,
    Dense Forest, Farms, Barren Land, Lakes, River, Coastal, Desert, Hills, Snow).
  - Features dérivées en plus : urban_density_score (ordinal 0–4),
    n_urban_tags, n_geo_tags, has_water, has_dense_forest, has_farms, is_rural.

Conclusion : one-hot multi-valued pour urban/geo est en place + features
dérivées utiles pour le contexte urbain/géographique.


2.2 Polygones – propriétés géométriques
---------------------------------------
Sujet : "Irregular polygons can be processed in several ways to create features:
         the area, the perimeter, or any other geometrical property of a polygon."

Fait dans le preprocess :
  - Reprojection en UTM (estimate_utm_crs()) pour des grandeurs en mètres.
  - area_sqm : aire du polygone
  - perimeter_m : périmètre
  - compactness : (4 * pi * area) / perimeter^2
  - length_m, width_m : longueur et largeur du minimum rotated rectangle
  - aspect_ratio : length_m / width_m
  - centroid_lon, centroid_lat
  - convex_area : aire de l’enveloppe convexe (safe_convex_area pour éviter les crashs)
  - bbox_height, bbox_width : hauteur/largeur de la bbox
  - num_vertices : nombre de sommets
  - max_radius : distance centroid → boundary (approx. rayon max)

Conclusion : area, perimeter et plusieurs autres propriétés géométriques
sont bien exploitées pour les polygones irréguliers.


2.3 Jours entre deux dates consécutives
---------------------------------------
Sujet : "The number of days between two consecutive dates could also be helpful."

Fait dans le preprocess :
  - process_time_between_statuses() :
    - timeline_len : nombre de points temporels distincts
    - total_duration_days : durée totale entre première et dernière date
    - delta_days_1, delta_days_2, ... : jours entre dates consécutives
    - days_to_<status> : jours jusqu’à chaque statut (Greenland, Land Cleared, etc.)
    - phase_days_<phase> : jours par phase (pre, site_prep, materials, construction, post)
    - prior_construction_present, prior_construction_before_cleared
    - Comptage de transitions entre statuts (tr_<status>_to_<status>)
  - process_timeline() en plus :
    - work_duration_days, avg_days_between_status
    - status_rank_max, status_progression_delta, unique_status_count

Conclusion : les délais entre dates consécutives et entre statuts sont bien
codés (deltas, durées par phase, transitions).


2.4 Autres features dérivées (images / timeline)
------------------------------------------------
En plus des idées du sujet, le preprocess ajoute :
  - Réordonnancement des 5 dates et des blocs associés (img_*, change_status_date*).
  - Features par date (t1..t5) : img_red/green/blue mean & std, brightness,
    texture, exg, exr, saturation, et leurs delta (t1 → t_last).
  - Status one-hot par date : status_<status>_date0..4 pour chaque statut.

Cela donne un set de features riche (géométrie + temps + statuts + images)
pour la classification de type de changement (change_type).

--------------------------------------------------------------------------------
3. RÉSUMÉ
--------------------------------------------------------------------------------

  - Preprocessing : GeoJSON → Parquet, nettoyage géométries et dates, pas de
    drop pour NaN/Inf coords (placeholder géométrique).
  - One-hot multi-valued : urban_type et geography_type + dérivées urbain/geo.
  - Features géométriques : area, perimeter, compactness, length/width,
    aspect_ratio, convex_area, bbox, num_vertices, max_radius, centroid.
  - Jours entre dates : delta_days, total_duration_days, phase_days,
    days_to_<status>, transitions entre statuts, work_duration_days,
    avg_days_between_status.

Tout ce que le sujet demande en feature engineering (one-hot urban/geo,
propriétés des polygones, jours entre dates consécutives) est couvert par
ton preprocess ; il ajoute en plus des features temporelles détaillées et
des indicateurs dérivés des images et des statuts.
